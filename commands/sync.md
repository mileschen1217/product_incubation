---
description: Sync traceability status to Linear — creates/updates/closes issues based on requirement IDs found in specs, code, and tests across the 17-area checklist.
disable-model-invocation: true
---

# Product Incubation: Sync to Linear

You are syncing the project's traceability status to Linear issues. This builds on the same scanning logic as `/product-incubation:audit` but pushes state to Linear.

## Prerequisites

Before running this command, the user needs three things set up:

### 1. Linear account with API key

The user must have a Linear account and a personal API key. If they don't have one, guide them:

1. Sign up or log in at [linear.app](https://linear.app)
2. Go to **Settings → Account → API** (or `linear.app/settings/api`)
3. Create a key and copy the token (starts with `lin_api_`)

### 2. Linear MCP server connected

The Linear MCP server must be registered with Claude Code. If not set up:

```bash
export LINEAR_API_KEY="lin_api_..."
claude mcp add linear -- npx -y @anthropic-ai/linear-mcp-server
```

### 3. Linear team (and optionally a project)

The user must have at least one team in Linear. A project is optional — if skipped, issues land in the team backlog.

### Pre-flight check

Attempt to use a Linear MCP tool (e.g., list teams). If the tool is unavailable or errors, inform the user which prerequisite is missing and suggest:
- Setting up the Linear MCP server (see above)
- Or using the audit command as a dry-run alternative: `/product-incubation:audit`

## Steps

### 1. Run the audit scan

Perform the same scanning logic as the audit command (17 areas):
- Scan `docs/` for requirement ID definitions
- Scan source code for `REQ: {PREFIX}-{NNN}` references
- Scan test files for `test_{PREFIX}_{NNN}_*` patterns
- Determine status for each requirement (todo/build/done)

The 17 prefixes are: `VIS`, `USR`, `KPI`, `FUNC`, `DATA`, `API`, `UX`, `ARCH`, `SEC`, `PERF`, `I18N`, `DEC`, `TEST`, `OBS`, `DEPLOY`, `OPS`, `ROAD`.

### 2. Ask for Linear target

Use AskUserQuestion to ask:

> **Which Linear team should requirements sync to?**

Then ask:

> **Which Linear project (optional)?**
> - Create a new project named "{Project Name} — Product Incubation"
> - Use an existing project (specify name)
> - No project, just team backlog

### 3. Load previous sync state

Check for `product-status.yaml` in the project root. If it exists, read it to determine what was previously synced.

The YAML format:

```yaml
# Auto-generated by /product-incubation:sync
# Last sync: YYYY-MM-DD HH:MM
linear_team: TEAM-KEY
linear_project: "Project Name"
requirements:
  FUNC-001:
    title: "CAD file upload"
    status: done
    linear_issue_id: TEAM-123
    last_synced: "2026-02-14"
  SEC-003:
    title: "Input validation"
    status: build
    linear_issue_id: TEAM-456
    last_synced: "2026-02-14"
```

### 4. Diff current vs previous state

Compare the current scan results with previous `product-status.yaml`:

| Change | Action |
|--------|--------|
| New requirement ID (not in YAML) | Create Linear issue |
| Status changed (e.g., todo -> build) | Update Linear issue status |
| Requirement removed from specs | Flag for review (add comment, do NOT auto-close) |
| No change | Skip |

### 5. Sync to Linear

**Status mapping:**

| Traceability status | Linear status |
|---------------------|--------------|
| `todo` (spec only) | Backlog |
| `build` (spec + code) | In Progress |
| `done` (spec + code + tests) | Done |

**For new issues:**
- Title: `[{PREFIX}-{NNN}] {Short title from spec}`
- Description: Include requirement definition from spec file, traceability status, and link to spec file
- Labels: Add area prefix as label (e.g., `FUNC`, `SEC`)
- Priority: No priority (let team decide)

**For status updates:**
- Transition the issue to the mapped Linear status
- Add comment: `Status changed: {old} -> {new} (synced by product-incubation)`

**For removed requirements:**
- Add comment: `Warning: Requirement {PREFIX}-{NNN} no longer found in specs. Review whether this issue should be closed.`
- Do NOT close the issue automatically

### 6. Write updated product-status.yaml

After syncing, write the updated `product-status.yaml` to the project root with:
- All requirement IDs, their current status, and Linear issue IDs
- Timestamp of last sync
- Linear team/project reference

### 7. Output summary

```
Product Incubation — Sync Complete
═══════════════════════════════════

Linear: {TEAM-KEY} / {Project Name}

Created: {n} new issues
  + [TEAM-123] FUNC-005: New feature title
  + [TEAM-124] SEC-004: Threat model

Updated: {n} issues
  ~ [TEAM-456] SEC-003: todo -> build

Flagged for review: {n} issues
  ? [TEAM-789] FUNC-002: Removed from specs

Unchanged: {n} issues

Total synced: {n} requirements -> {n} Linear issues
```

### 8. Rules

- **Always confirm with user before creating issues.** Show the plan (what will be created/updated/flagged) and ask for approval before executing.
- **Never auto-close Linear issues.** Removed requirements get a comment, not closure.
- **Idempotent:** Running sync twice with no changes should produce zero actions.
- **Preserve manual changes:** If a Linear issue was manually moved to a different status, the sync should NOT override it. Add a comment noting the discrepancy instead.
- If Linear MCP is not available, output the sync plan as a dry-run report and suggest manual actions.
